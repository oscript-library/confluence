# Функции взимодействия с confluence

## Введение

Модуль предоставляет набор функционала для взаимодействия с Atlassian Confluence посредством REST-API.
Описание продукта по ссылке `https://ru.atlassian.com/software/confluence`

## Установка

Библиотеку можно установить несколькими способами:

* Используя менеджер пакетов opm

```
opm install confluence
```

* Создание файл .ospx и установка через opm

Во временный каталог клонируем библиотеку

``` 
git clone https://github.com/otymko/os-confluence.git
```

Во временном каталоге выполняем команду 

``` 
opm build os-confluence
```

Устанавливаем пакет с библиотекой

``` 
opm install -f confluence*.ospx
```
где,  confluence*.ospx - имя файла с пакетом для oscript

Например:

```
PS F:\DATA\Develop\temp\1> opm build .\os-confluence\

ИНФОРМАЦИЯ - Начинаю сборку в каталоге .\os-confluence\
ИНФОРМАЦИЯ - Найден файл манифеста
ИНФОРМАЦИЯ - Загружаю описание пакета...
ИНФОРМАЦИЯ - Описание пакета прочитано
ИНФОРМАЦИЯ - Записаны метаданные пакета
ИНФОРМАЦИЯ - Добавляем файл: readme.md
ИНФОРМАЦИЯ - Добавляем файл: src
ИНФОРМАЦИЯ - Добавляем файл: lib.config
ИНФОРМАЦИЯ - Создана сборка F:\DATA\Develop\temp\1\confluence-1.0.5.ospx
ИНФОРМАЦИЯ - Сборка пакета завершена

PS F:\DATA\Develop\temp\1> opm install -f .\confluence-1.0.5.ospx
ИНФОРМАЦИЯ - Устанавливаю пакет confluence
ИНФОРМАЦИЯ - Установка завершена
ИНФОРМАЦИЯ - Устанавливаю зависимость: json
ИНФОРМАЦИЯ - json уже установлен. Пропускаем.
```

*  Копированием библиотеки в папку lib osctript (требуется установленная библиотека json)

во временный каталог клонируем библиотеку

``` 
git clone https://github.com/otymko/os-confluence.git
```

Копируем библиотеку в папку /path/to/oscript/lib

## Использование

Все методы модуля требуют параметры подключения к серверу confluence: Адрес и учетные данные.

Для начала необходимо сформировать описание подключения методом `ОписаниеПодключения`

### Примеры

#### Подключение

`Подключение = Confluence.ОписаниеПодключения("https://confluence.myserver.ru", "user", "password")`.

#### Создание страницы

`ИдентификаторНовойСтраницы = Confluence.СоздатьСтраницу(Подключение, "SpaceKey", "Новая страница", "Содержимое новой страницы")`

#### Переименование страницы

`ИдентификаторНовойСтраницы = Confluence.ОбновитьСтраницу(Подключение, "SpaceKey", "Новое имя страницы", ИдентификаторНовойСтраницы)`

#### Удаление страницы

`Confluence.УдалитьСтраницу(Подключение, "SpaceKey", "Новое имя страницы")`

#### Установка метки странице

`Confluence.ПрикрепитьМеткуКСтранице(ПараметрыПодключения, ИдентификаторСтраницы, "Моя метка")`

### Примеры нового API

```bsl

// Настройки подключения
Подключение = Confluence.ОписаниеПодключения("https://confluence.myserver.ru", "user", "password")

// Получение идентификатора страницы
ИдентификаторРодителя = Confluence.НайтиСтраницуПоИмени(Подключение, "SpaceKey", "Корневая страница");

// Структура адреса страницы (Пространство, Наименование, Идентификатор, Родитель)
АдресСтраницы = Confluence.АдресСтраницы("SpaceKey", "Новая страница", , ИдентификаторРодителя);

// Создадим новую страницу
Confluence.Создать(Подключение, АдресСтраницы, "Содержимое страницы");
Сообщить("Идентификатор новой страницы: " + АдресСтраницы.Идентификатор)

// Обновим содержимое
Confluence.Обновить(Подключение, АдресСтраницы, "Новое содержимое страницы", Истина);

// Адрес второй страницы
АдресСтраницы = Confluence.АдресСтраницы("SpaceKey", "Вторая страница", , ИдентификаторРодителя);

// Обновим если содержимое отличается, либо создадим если отсутствует
Confluence.СоздатьИлиОбновить(Подключение, АдресСтраницы, "Содержимое второй страницы");

// Опубликуем страницу в формате Markdown
АдресСтраницы = Confluence.АдресСтраницы("SpaceKey", "Третья страница Markdown", , ИдентификаторРодителя);
Содержимое = Новый Структура("Значение, Формат", "# Содержимое третьей страницы", confluence.ФорматыСодержимого.MarkDown);
Confluence.СоздатьИлиОбновить(Подключение, АдресСтраницы, Содержимое);


```
